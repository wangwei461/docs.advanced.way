<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DispatcherServlet | 进阶之路</title>
    <meta name="generator" content="VuePress 1.6.0">
    
    <meta name="description" content="架构师">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/docs.advanced.way/assets/css/0.styles.1ab0c6f4.css" as="style"><link rel="preload" href="/docs.advanced.way/assets/js/app.49496410.js" as="script"><link rel="preload" href="/docs.advanced.way/assets/js/6.90d4b438.js" as="script"><link rel="preload" href="/docs.advanced.way/assets/js/2.b0fb1ff8.js" as="script"><link rel="preload" href="/docs.advanced.way/assets/js/15.b18efea4.js" as="script"><link rel="prefetch" href="/docs.advanced.way/assets/js/10.51292ca0.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/100.1b1c688b.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/101.40c70406.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/102.ab1f082f.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/103.3040b4fb.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/104.8810720b.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/105.2b1464ff.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/106.282cff60.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/107.2826bd4d.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/108.68e321e9.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/109.27c8bc0f.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/11.0e1bc0f5.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/110.90265c5b.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/111.2558bd0b.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/112.3b03fd93.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/113.01730c15.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/114.64dc666f.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/115.b96d5064.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/116.4f11a182.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/117.22397ee8.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/118.1a1d8691.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/119.014f57c5.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/12.8c9940dc.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/120.91cf4642.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/121.44ce141b.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/122.43e89b9f.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/123.e827ff44.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/124.1f5a4fd7.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/125.32c748dd.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/126.1e005a7a.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/127.5dc69846.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/128.f0ee67c7.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/129.b9274a25.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/13.31af3e19.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/130.ece56848.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/131.5bfb0419.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/132.d1a6688e.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/133.6f4c4e8f.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/134.d61e2f2a.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/135.0dd2d733.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/136.42494db2.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/137.1a7a314e.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/138.448f41de.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/139.9a0df213.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/14.89f7e3ca.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/140.d3d6e733.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/141.0f3c078e.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/142.df553c01.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/143.d986fa40.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/144.c6edcb17.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/145.037329d8.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/146.1caf82eb.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/147.e07c16cc.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/148.eb6a4a93.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/149.01ad9422.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/150.37d2b84b.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/151.58a6df51.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/152.89b36b2b.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/153.6afdca2c.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/154.88ec3e78.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/155.21b4d922.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/156.d91c04b3.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/157.27b19a97.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/158.95fe6881.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/159.76ab38fb.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/16.54ed244a.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/160.9bf3ad34.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/161.9eb8936c.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/162.0c746471.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/163.b02e1bec.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/164.808c57db.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/165.33886d11.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/166.c0cf32fc.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/167.2534cf09.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/168.20c4f647.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/169.9012353e.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/17.28f5f7f8.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/170.6585fa9f.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/171.47fe843d.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/172.0052b3ae.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/173.84fd5d9a.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/174.a766914d.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/175.c27ecb6c.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/176.f4f07e8c.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/18.1d032378.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/19.aca6a1cc.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/20.62d5932f.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/21.aaaff004.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/22.dc68101f.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/23.8b690408.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/24.29209597.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/25.3c281bec.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/26.568ae118.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/27.ff73c416.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/28.9afa702a.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/29.bf6f425d.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/3.8eaf6937.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/30.a22ad272.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/31.0e7dfbea.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/32.3a4e9a35.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/33.f6480c22.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/34.5f017b07.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/35.d5c8f6c6.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/36.249db163.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/37.038b1a3f.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/38.381660d1.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/39.415ad106.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/4.3fc36225.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/40.684535d4.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/41.d20383e0.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/42.946894b7.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/43.eccfa254.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/44.0dd8ade6.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/45.734d6d45.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/46.130d6dd0.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/47.e264c50c.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/48.34797fe3.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/49.d9fc526c.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/5.342191f8.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/50.10570fda.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/51.cd782a90.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/52.0706c85c.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/53.c37f3d60.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/54.3bf67e15.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/55.531de061.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/56.fcc31f3e.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/57.1c107844.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/58.9dfe8968.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/59.f13e57ff.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/60.9f85ceb3.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/61.ef70edf8.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/62.291ec608.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/63.bc744669.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/64.6d0ad56a.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/65.cf3e5c36.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/66.44d5f4e7.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/67.23f828af.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/68.0a4786bc.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/69.96071acd.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/7.054bdeae.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/70.e344774a.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/71.18005a88.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/72.c69a0f27.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/73.1ec01a9a.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/74.d38e764a.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/75.a05c224c.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/76.f7612fba.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/77.d08cf41e.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/78.ca635495.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/79.57477bba.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/8.c73b783c.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/80.0a46aa5d.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/81.31e6a98b.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/82.bd627254.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/83.a6e7ce49.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/84.5e8b8b88.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/85.f33d97ff.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/86.9cc1a6ad.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/87.9d9421d1.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/88.b4c2eba5.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/89.011a1cc7.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/9.74ecee10.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/90.efdb8272.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/91.9a9cacde.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/92.4b0a4243.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/93.2b6e4d6e.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/94.b5e6a8e1.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/95.92039e33.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/96.2996da97.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/97.4942bfb6.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/98.8899e3b1.js"><link rel="prefetch" href="/docs.advanced.way/assets/js/99.7cd21a9c.js">
    <link rel="stylesheet" href="/docs.advanced.way/assets/css/0.styles.1ab0c6f4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs.advanced.way/" class="home-link router-link-active"><!----> <span class="site-name">进阶之路</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs.advanced.way/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><span class="title">常用框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用框架" class="mobile-dropdown-title"><span class="title">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs.advanced.way/framework/spring/" class="nav-link router-link-active">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/framework/mybatis/" class="nav-link">
  Mybatis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式/架构" class="dropdown-title"><span class="title">分布式/架构</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式/架构" class="mobile-dropdown-title"><span class="title">分布式/架构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          架构师之路
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs.advanced.way/architecture/" class="nav-link">
  架构设计
</a></li></ul></li><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs.advanced.way/distributed/tranctional/" class="nav-link">
  事务
</a></li><li class="dropdown-subitem"><a href="/docs.advanced.way/distributed/springcloud/" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-subitem"><a href="/docs.advanced.way/distributed/servicemesh/" class="nav-link">
  服务网格
</a></li><li class="dropdown-subitem"><a href="/docs.advanced.way/distributed/mq/" class="nav-link">
  消息队列
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><span class="title">云原生</span> <span class="arrow down"></span></button> <button type="button" aria-label="云原生" class="mobile-dropdown-title"><span class="title">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs.advanced.way/cloud/docker/" class="nav-link">
  Docker容器
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/cloud/k8s/" class="nav-link">
  Kubernetes
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务器" class="dropdown-title"><span class="title">服务器</span> <span class="arrow down"></span></button> <button type="button" aria-label="服务器" class="mobile-dropdown-title"><span class="title">服务器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs.advanced.way/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/cache/" class="nav-link">
  缓存
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/db/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/cs/" class="nav-link">
  计算机系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编码实践" class="dropdown-title"><span class="title">编码实践</span> <span class="arrow down"></span></button> <button type="button" aria-label="编码实践" class="mobile-dropdown-title"><span class="title">编码实践</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs.advanced.way/algorithm/" class="nav-link">
  算法/数据结构
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/patterns/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/job/" class="nav-link">
  面试
</a></li></ul></div></div> <a href="https://github.com/wangwei461/docs.advanced.way.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs.advanced.way/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><span class="title">常用框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用框架" class="mobile-dropdown-title"><span class="title">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs.advanced.way/framework/spring/" class="nav-link router-link-active">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/framework/mybatis/" class="nav-link">
  Mybatis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="分布式/架构" class="dropdown-title"><span class="title">分布式/架构</span> <span class="arrow down"></span></button> <button type="button" aria-label="分布式/架构" class="mobile-dropdown-title"><span class="title">分布式/架构</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          架构师之路
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs.advanced.way/architecture/" class="nav-link">
  架构设计
</a></li></ul></li><li class="dropdown-item"><h4>
          分布式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/docs.advanced.way/distributed/tranctional/" class="nav-link">
  事务
</a></li><li class="dropdown-subitem"><a href="/docs.advanced.way/distributed/springcloud/" class="nav-link">
  SpringCloud
</a></li><li class="dropdown-subitem"><a href="/docs.advanced.way/distributed/servicemesh/" class="nav-link">
  服务网格
</a></li><li class="dropdown-subitem"><a href="/docs.advanced.way/distributed/mq/" class="nav-link">
  消息队列
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><span class="title">云原生</span> <span class="arrow down"></span></button> <button type="button" aria-label="云原生" class="mobile-dropdown-title"><span class="title">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs.advanced.way/cloud/docker/" class="nav-link">
  Docker容器
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/cloud/k8s/" class="nav-link">
  Kubernetes
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="服务器" class="dropdown-title"><span class="title">服务器</span> <span class="arrow down"></span></button> <button type="button" aria-label="服务器" class="mobile-dropdown-title"><span class="title">服务器</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs.advanced.way/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/cache/" class="nav-link">
  缓存
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/db/" class="nav-link">
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/cs/" class="nav-link">
  计算机系统
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编码实践" class="dropdown-title"><span class="title">编码实践</span> <span class="arrow down"></span></button> <button type="button" aria-label="编码实践" class="mobile-dropdown-title"><span class="title">编码实践</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs.advanced.way/algorithm/" class="nav-link">
  算法/数据结构
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/patterns/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/docs.advanced.way/job/" class="nav-link">
  面试
</a></li></ul></div></div> <a href="https://github.com/wangwei461/docs.advanced.way.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Spring MVC</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs.advanced.way/framework/spring/springmvc/简介.html" class="sidebar-link">简介</a></li><li><a href="/docs.advanced.way/framework/spring/springmvc/核心组件.html" class="sidebar-link">核心组件</a></li><li><a href="/docs.advanced.way/framework/spring/springmvc/Servlet.html" class="sidebar-link">Servlet</a></li><li><a href="/docs.advanced.way/framework/spring/springmvc/Session.html" class="sidebar-link">Session</a></li><li><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html" aria-current="page" class="active sidebar-link">DispatcherServlet</a></li><li><a href="/docs.advanced.way/framework/spring/springmvc/RequestMapping.html" class="sidebar-link">@RequestMapping</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring Boot</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="dispatcherservlet"><a href="#dispatcherservlet" class="header-anchor">#</a> DispatcherServlet</h2> <p>前端控制器模式</p> <h3 id="结构图"><a href="#结构图" class="header-anchor">#</a> 结构图</h3> <p><img src="/docs.advanced.way/assets/img/DispatcherServlet.aa87e156.png" alt=""></p> <h2 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h2> <p><img src="/docs.advanced.way/assets/img/2019021808191633.ba48d32c.png" alt=""></p> <h2 id="工作流程"><a href="#工作流程" class="header-anchor">#</a> 工作流程</h2> <p><img src="/docs.advanced.way/assets/img/714509-20170920165202868-445512458.9ce50d9c.png" alt=""></p> <h3 id="流程说明"><a href="#流程说明" class="header-anchor">#</a> 流程说明</h3> <ol><li><p>客户端向服务器发送http请求,请求被前端控制器 <code>dispatcherServlet</code> 捕获</p></li> <li><p><code>dispatcherServlet</code> 根据配置,对url进行解析, 在根据uri调用 <code>HandlerMapping</code> 获取该 <code>Handler</code> 配置的有关对象(包括 <code>Handler</code> 对象以及 <code>Handler</code> 对象对应的拦截器), 最后以 <code>HandlerExecutionChain</code> 的形式返回</p></li> <li><p><code>dispatcherServlet</code> 根据获得的 <code>Handler</code> ,选择一个合适 <code>HandlerAdapter</code> (如果获得成功,就将执行拦截器对应的 <code>preHandler</code> 方法)</p></li> <li><p>适配器 <code>HandlerAdapter</code> 将 <code>Request</code> 中的模型数据传入 <code>Handler(Controller)</code></p></li> <li><p><code>Handler(Controller)</code> 执行结束后,返回一个 <code>ModelAndView</code> 对象</p></li> <li><p>根据返回的 <code>ModelAndView</code> ,选择一个合适的已经注册到 <code>Spring</code>容器的 <code>ViewResolver</code> ,返回给 <code>dispatcherServlet</code></p></li> <li><p><code>viewResolver</code> 结合 <code>Model</code> 和 <code>View</code> 渲染视图</p></li> <li><p><code>View</code> 视图负责将渲染结果返回给客户端</p></li></ol> <h3 id="如何进入分发中心"><a href="#如何进入分发中心" class="header-anchor">#</a> 如何进入分发中心</h3> <h4 id="httpservlet"><a href="#httpservlet" class="header-anchor">#</a> HttpServlet</h4> <p>请求先到达 HttpServlet 的service方法，service决定调用具体的doGet，doPost等方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// HttpServlet 提供了对 Http 协议的 Servlet 实现</span>
<span class="token comment">// GenericServlet 提供了默认的生命周期管理</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">HttpServlet</span> <span class="token keyword">extends</span> <span class="token class-name">GenericServlet</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> res<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">HttpServletRequest</span>  request<span class="token punctuation">;</span>
        <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>req <span class="token keyword">instanceof</span> <span class="token class-name">HttpServletRequest</span> <span class="token operator">&amp;&amp;</span>
                res <span class="token keyword">instanceof</span> <span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServletException</span><span class="token punctuation">(</span><span class="token string">&quot;non-HTTP request or response&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 将 Servlet 转换成 HttpServlet</span>
        request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> req<span class="token punctuation">;</span>
        response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> res<span class="token punctuation">;</span>

        <span class="token comment">// 调用</span>
        <span class="token function">service</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// service 方法</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 获取请求方法</span>
        <span class="token class-name">String</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 判断方法类型</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>METHOD_GET<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> lastModified <span class="token operator">=</span> <span class="token function">getLastModified</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lastModified <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// servlet doesn't support if-modified-since, no reason</span>
                <span class="token comment">// to go through further expensive logic</span>
                <span class="token function">doGet</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> ifModifiedSince <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getDateHeader</span><span class="token punctuation">(</span>HEADER_IFMODSINCE<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ifModifiedSince <span class="token operator">&lt;</span> lastModified<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// If the servlet mod time is later, call doGet()</span>
                    <span class="token comment">// Round down to the nearest second for a proper compare</span>
                    <span class="token comment">// A ifModifiedSince of -1 will always be less</span>
                    <span class="token function">maybeSetLastModified</span><span class="token punctuation">(</span>resp<span class="token punctuation">,</span> lastModified<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">doGet</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    resp<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">.</span>SC_NOT_MODIFIED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>METHOD_HEAD<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> lastModified <span class="token operator">=</span> <span class="token function">getLastModified</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">maybeSetLastModified</span><span class="token punctuation">(</span>resp<span class="token punctuation">,</span> lastModified<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">doHead</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>METHOD_POST<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">doPost</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>METHOD_PUT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">doPut</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>METHOD_DELETE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">doDelete</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>METHOD_OPTIONS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">doOptions</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>METHOD_TRACE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">doTrace</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//</span>
            <span class="token comment">// Note that this means NO servlet supports whatever</span>
            <span class="token comment">// method was requested, anywhere on this server.</span>
            <span class="token comment">//</span>

            <span class="token class-name">String</span> errMsg <span class="token operator">=</span> lStrings<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;http.method_not_implemented&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> errArgs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            errArgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> method<span class="token punctuation">;</span>
            errMsg <span class="token operator">=</span> <span class="token class-name">MessageFormat</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">,</span> errArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            resp<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">.</span>SC_NOT_IMPLEMENTED<span class="token punctuation">,</span> errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="frameworkservlet"><a href="#frameworkservlet" class="header-anchor">#</a> FrameworkServlet</h4> <ol><li><p>FrameworkServlet 重写了 HttpServlet的doGet等方法，于是就会调用FrameworkServlet的doGet等方法</p></li> <li><p>在doGet等方法中都会调用 processRequest(request, response)方法</p></li> <li><p>调用doService(request, response). 由于doService在FrameworkServlet中为抽象方法，所以调用DispatcherServlet重写的doService方法</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">FrameworkServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServletBean</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationContextAware</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

		<span class="token function">processRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

		<span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Throwable</span> failureCause <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

		<span class="token class-name">LocaleContext</span> previousLocaleContext <span class="token operator">=</span> <span class="token class-name">LocaleContextHolder</span><span class="token punctuation">.</span><span class="token function">getLocaleContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">LocaleContext</span> localeContext <span class="token operator">=</span> <span class="token function">buildLocaleContext</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">RequestAttributes</span> previousAttributes <span class="token operator">=</span> <span class="token class-name">RequestContextHolder</span><span class="token punctuation">.</span><span class="token function">getRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">ServletRequestAttributes</span> requestAttributes <span class="token operator">=</span> <span class="token function">buildRequestAttributes</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> previousAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">WebAsyncManager</span> asyncManager <span class="token operator">=</span> <span class="token class-name">WebAsyncUtils</span><span class="token punctuation">.</span><span class="token function">getAsyncManager</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
		asyncManager<span class="token punctuation">.</span><span class="token function">registerCallableInterceptor</span><span class="token punctuation">(</span><span class="token class-name">FrameworkServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RequestBindingInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">initContextHolders</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> localeContext<span class="token punctuation">,</span> requestAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 抽象方法，调用 DispatcherServlet 重写的 doService方法</span>
			<span class="token function">doService</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ServletException</span> <span class="token operator">|</span> <span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			failureCause <span class="token operator">=</span> ex<span class="token punctuation">;</span>
			<span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			failureCause <span class="token operator">=</span> ex<span class="token punctuation">;</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NestedServletException</span><span class="token punctuation">(</span><span class="token string">&quot;Request processing failed&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">finally</span> <span class="token punctuation">{</span>
			<span class="token function">resetContextHolders</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> previousLocaleContext<span class="token punctuation">,</span> previousAttributes<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>requestAttributes <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				requestAttributes<span class="token punctuation">.</span><span class="token function">requestCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token function">logResult</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> failureCause<span class="token punctuation">,</span> asyncManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">publishRequestHandledEvent</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> failureCause<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="dispatcherservlet-2"><a href="#dispatcherservlet-2" class="header-anchor">#</a> DispatcherServlet</h4> <p>调用 doDispatch(request, response)</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DispatcherServlet</span> <span class="token keyword">extends</span> <span class="token class-name">FrameworkServlet</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doService</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token function">logRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Keep a snapshot of the request attributes in case of an include,</span>
		<span class="token comment">// to be able to restore the original attributes after the include.</span>
		<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> attributesSnapshot <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">WebUtils</span><span class="token punctuation">.</span><span class="token function">isIncludeRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			attributesSnapshot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> attrNames <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getAttributeNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>attrNames<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">String</span> attrName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> attrNames<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cleanupAfterInclude <span class="token operator">||</span> attrName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>DEFAULT_STRATEGIES_PREFIX<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					attributesSnapshot<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>attrName<span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Make framework objects available to handlers and view objects.</span>
		request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>WEB_APPLICATION_CONTEXT_ATTRIBUTE<span class="token punctuation">,</span> <span class="token function">getWebApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>LOCALE_RESOLVER_ATTRIBUTE<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>localeResolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
		request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>THEME_RESOLVER_ATTRIBUTE<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>themeResolver<span class="token punctuation">)</span><span class="token punctuation">;</span>
		request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>THEME_SOURCE_ATTRIBUTE<span class="token punctuation">,</span> <span class="token function">getThemeSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>flashMapManager <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">FlashMap</span> inputFlashMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>flashMapManager<span class="token punctuation">.</span><span class="token function">retrieveAndUpdate</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>inputFlashMap <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>INPUT_FLASH_MAP_ATTRIBUTE<span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableMap</span><span class="token punctuation">(</span>inputFlashMap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>OUTPUT_FLASH_MAP_ATTRIBUTE<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FlashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>FLASH_MAP_MANAGER_ATTRIBUTE<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>flashMapManager<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token function">doDispatch</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">finally</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">WebAsyncUtils</span><span class="token punctuation">.</span><span class="token function">getAsyncManager</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isConcurrentHandlingStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// Restore the original attribute snapshot, in case of an include.</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>attributesSnapshot <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">restoreAttributesAfterInclude</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> attributesSnapshot<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 请求分发中心</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doDispatch</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token comment">// 定义一个已处理请求，指向 request</span>
		<span class="token class-name">HttpServletRequest</span> processedRequest <span class="token operator">=</span> request<span class="token punctuation">;</span>
		<span class="token comment">// 定义处理器执行链 内部封装拦截器列表和处理器</span>
		<span class="token class-name">HandlerExecutionChain</span> mappedHandler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> multipartRequestParsed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

		<span class="token comment">// 获取和当前请求相关的异步管理器</span>
		<span class="token class-name">WebAsyncManager</span> asyncManager <span class="token operator">=</span> <span class="token class-name">WebAsyncUtils</span><span class="token punctuation">.</span><span class="token function">getAsyncManager</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
			<span class="token class-name">Exception</span> dispatchException <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token comment">// 判断是否有文件上传，如果是，返回一个新的请求</span>
				processedRequest <span class="token operator">=</span> <span class="token function">checkMultipart</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
				multipartRequestParsed <span class="token operator">=</span> <span class="token punctuation">(</span>processedRequest <span class="token operator">!=</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// getHandler 中遍历 HandlerMapping，获取对应的 HandlerExecutionChain</span>
				<span class="token comment">// HandlerExecutionChain，包含 HandlerInterceptor 和HandlerMethod</span>
				<span class="token comment">// Determine handler for the current request.</span>
				mappedHandler <span class="token operator">=</span> <span class="token function">getHandler</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>mappedHandler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// not found</span>
					<span class="token function">noHandlerFound</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token comment">// 获取支持该处理器的处理适配器</span>
				<span class="token class-name">HandlerAdapter</span> ha <span class="token operator">=</span> <span class="token function">getHandlerAdapter</span><span class="token punctuation">(</span>mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// 判断请求内容是否需要修改，如果未修改直接返回，浏览器使用本地缓存</span>
				<span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">boolean</span> isGet <span class="token operator">=</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>isGet <span class="token operator">||</span> <span class="token string">&quot;HEAD&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">long</span> lastModified <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">getLastModified</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletWebRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkNotModified</span><span class="token punctuation">(</span>lastModified<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isGet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">return</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>

				<span class="token comment">// 如果有拦截器的话，会执行拦截器的 preHandler 方法</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mappedHandler<span class="token punctuation">.</span><span class="token function">applyPreHandle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// 拦截器生效 返回</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 对请求进行处理，传入请求、响应、对应的处理器</span>
				mv <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// 判断是否是异步请求，后续操作均通过异步处理</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>asyncManager<span class="token punctuation">.</span><span class="token function">isConcurrentHandlingStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token comment">// 当view为空时，根据request设置默认view</span>
				<span class="token function">applyDefaultViewName</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// 执行拦截器的 postHandle</span>
				mappedHandler<span class="token punctuation">.</span><span class="token function">applyPostHandle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 发送异常 保存到 dispatchException</span>
				dispatchException <span class="token operator">=</span> ex<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// As of 4.3, we're processing Errors thrown from handler methods as well,</span>
				<span class="token comment">// making them available for @ExceptionHandler methods and other scenarios.</span>
				dispatchException <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NestedServletException</span><span class="token punctuation">(</span><span class="token string">&quot;Handler dispatch failed&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// 对执行结果进行处理，包括处理适配器的结果和发送的异常</span>
			<span class="token function">processDispatchResult</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">,</span> mv<span class="token punctuation">,</span> dispatchException<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">,</span>
					<span class="token keyword">new</span> <span class="token class-name">NestedServletException</span><span class="token punctuation">(</span><span class="token string">&quot;Handler processing failed&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">finally</span> <span class="token punctuation">{</span>
			<span class="token comment">// 判断是否是异步请求</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>asyncManager<span class="token punctuation">.</span><span class="token function">isConcurrentHandlingStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// Instead of postHandle and afterCompletion</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>mappedHandler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					mappedHandler<span class="token punctuation">.</span><span class="token function">applyAfterConcurrentHandlingStarted</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// 删除上传资源</span>
				<span class="token comment">// Clean up any resources used by a multipart request.</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>multipartRequestParsed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">cleanupMultipart</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="请求分发详解"><a href="#请求分发详解" class="header-anchor">#</a> 请求分发详解</h2> <h3 id="文件上传请求"><a href="#文件上传请求" class="header-anchor">#</a> 文件上传请求</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">HttpServletRequest</span> <span class="token function">checkMultipart</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MultipartException</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断是否为多块请求</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>multipartResolver <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>multipartResolver<span class="token punctuation">.</span><span class="token function">isMultipart</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">WebUtils</span><span class="token punctuation">.</span><span class="token function">getNativeRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">MultipartHttpServletRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getDispatcherType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">DispatcherType</span><span class="token punctuation">.</span>REQUEST<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Request already resolved to MultipartHttpServletRequest, e.g. by MultipartFilter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 包含异常</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasMultipartException</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Multipart resolution previously failed for current request - &quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;skipping re-resolution for undisturbed error rendering&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 使用多块解析器解析多块请求，并返回多块请求解析器包装过的多块请求</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>multipartResolver<span class="token punctuation">.</span><span class="token function">resolveMultipart</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MultipartException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">WebUtils</span><span class="token punctuation">.</span>ERROR_EXCEPTION_ATTRIBUTE<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Multipart resolution failed for error dispatch&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Keep processing error dispatch with regular request handle below</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// If not returned before: return original request.</span>
    <span class="token keyword">return</span> request<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="查找请求处理器"><a href="#查找请求处理器" class="header-anchor">#</a> 查找请求处理器</h3> <p>Spring mvc 将请求处理的查找和执行分离开</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 遍历全部的处理器映射</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HandlerMapping</span> mapping <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取与本次请求适配的处理器链</span>
            <span class="token class-name">HandlerExecutionChain</span> handler <span class="token operator">=</span> mapping<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 返回，有多个处理器链只返回第一个</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> handler<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="获取处理适配器"><a href="#获取处理适配器" class="header-anchor">#</a> 获取处理适配器</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">HandlerAdapter</span> <span class="token function">getHandlerAdapter</span><span class="token punctuation">(</span><span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerAdapters <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 遍历处理适配器列表，调用supports方法，找到支持改处理器的适配器</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HandlerAdapter</span> adapter <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlerAdapters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 找到后返回</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>adapter<span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> adapter<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServletException</span><span class="token punctuation">(</span><span class="token string">&quot;No adapter for handler [&quot;</span> <span class="token operator">+</span> handler <span class="token operator">+</span>
            <span class="token string">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="处理http缓存"><a href="#处理http缓存" class="header-anchor">#</a> 处理Http缓存</h3> <p>为了提高 Http 请求效率，允许浏览器对Get 请求的获取到的资源进行缓存</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 判断请求内容是否需要修改，如果未修改直接返回，浏览器使用本地缓存</span>
<span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> isGet <span class="token operator">=</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 只支持 &quot;get head&quot; 请求</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isGet <span class="token operator">||</span> <span class="token string">&quot;HEAD&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取最后一次修改的时间</span>
    <span class="token keyword">long</span> lastModified <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">getLastModified</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 检查当前请求中携带的缓存信息是否过期</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletWebRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkNotModified</span><span class="token punctuation">(</span>lastModified<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isGet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="执行前置拦截器链"><a href="#执行前置拦截器链" class="header-anchor">#</a> 执行前置拦截器链</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">applyPreHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
		<span class="token comment">// 获取当前处理器执行链的所有拦截器</span>
		<span class="token class-name">HandlerInterceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> <span class="token function">getInterceptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 遍历拦截器</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> interceptors<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">HandlerInterceptor</span> interceptor <span class="token operator">=</span> interceptors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token comment">// 执行拦截器的preHandle方法</span>
				<span class="token comment">// 返回 false,停止执行</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>interceptor<span class="token punctuation">.</span><span class="token function">preHandle</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 返回 true， 拦截器索引设为当前遍历索引</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>interceptorIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 执行完毕</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="处理适配器执行"><a href="#处理适配器执行" class="header-anchor">#</a> 处理适配器执行</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 对请求进行处理，传入请求、响应、对应的处理器</span>
mv <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="返回值视图名处理"><a href="#返回值视图名处理" class="header-anchor">#</a> 返回值视图名处理</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">applyDefaultViewName</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndView</span> mv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token comment">// mv 不为空 且不包含视图</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mv <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mv<span class="token punctuation">.</span><span class="token function">hasView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取默认的视图名</span>
        <span class="token class-name">String</span> defaultViewName <span class="token operator">=</span> <span class="token function">getDefaultViewName</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>defaultViewName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 默认的视图名不为空，则将其设置为 ModelAndView 的视图名</span>
            mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span>defaultViewName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">String</span> <span class="token function">getDefaultViewName</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>viewNameTranslator <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>viewNameTranslator<span class="token punctuation">.</span><span class="token function">getViewName</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="执行后置拦截器链"><a href="#执行后置拦截器链" class="header-anchor">#</a> 执行后置拦截器链</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">applyPostHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndView</span> mv<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

		<span class="token class-name">HandlerInterceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> <span class="token function">getInterceptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> interceptors<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">HandlerInterceptor</span> interceptor <span class="token operator">=</span> interceptors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">// 执行，无返回值</span>
				interceptor<span class="token punctuation">.</span><span class="token function">postHandle</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="处理返回值和响应"><a href="#处理返回值和响应" class="header-anchor">#</a> 处理返回值和响应</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">processDispatchResult</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">HandlerExecutionChain</span> mappedHandler<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndView</span> mv<span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

    <span class="token comment">// 标记是否是 error 视图</span>
    <span class="token keyword">boolean</span> errorView <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">// 发生异常</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token keyword">instanceof</span> <span class="token class-name">ModelAndViewDefiningException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ModelAndViewDefiningException encountered&quot;</span><span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mv <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ModelAndViewDefiningException</span><span class="token punctuation">)</span> exception<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 获取处理器</span>
            <span class="token class-name">Object</span> handler <span class="token operator">=</span> <span class="token punctuation">(</span>mappedHandler <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 执行process处理器的异常方法，获取处理了异常结果后得到的ModelAndView结果</span>
            mv <span class="token operator">=</span> <span class="token function">processHandlerException</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 返回异常视图</span>
            errorView <span class="token operator">=</span> <span class="token punctuation">(</span>mv <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Did the handler return a view to render?</span>
    <span class="token comment">// 视图和模型不为空，且视图与模型没哟标记为被清理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mv <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mv<span class="token punctuation">.</span><span class="token function">wasCleared</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 执行渲染视图的操作</span>
        <span class="token function">render</span><span class="token punctuation">(</span>mv<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果是异常视图，渲染后需要清理请求属性的异常信息</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errorView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">WebUtils</span><span class="token punctuation">.</span><span class="token function">clearErrorRequestAttributes</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 视图为空，打印日志</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;No view rendering, null ModelAndView returned.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果异步处理已经开始，则直接返回结束执行</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">WebAsyncUtils</span><span class="token punctuation">.</span><span class="token function">getAsyncManager</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isConcurrentHandlingStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Concurrent handling started during a forward</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 触发拦截器链的完成后方法</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mappedHandler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Exception (if any) is already handled..</span>
        mappedHandler<span class="token punctuation">.</span><span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="执行完成拦截器链"><a href="#执行完成拦截器链" class="header-anchor">#</a> 执行完成拦截器链</h3> <p>在请求过程中无论是 preHandle 提前返回 false,还是处理过程中发生了异常，或是正常处理完成，都会调用拦截器链的该方法</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>

		<span class="token class-name">HandlerInterceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> <span class="token function">getInterceptors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 以 interceptorIndex 索引开始倒序遍历</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorIndex<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">HandlerInterceptor</span> interceptor <span class="token operator">=</span> interceptors<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">try</span> <span class="token punctuation">{</span>
					<span class="token comment">// 执行拦截器的 afterCompletion 方法</span>
					interceptor<span class="token punctuation">.</span><span class="token function">afterCompletion</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;HandlerInterceptor.afterCompletion threw exception&quot;</span><span class="token punctuation">,</span> ex2<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="清理资源"><a href="#清理资源" class="header-anchor">#</a> 清理资源</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">cleanupMultipart</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>multipartResolver <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">MultipartHttpServletRequest</span> multipartRequest <span class="token operator">=</span>
                <span class="token class-name">WebUtils</span><span class="token punctuation">.</span><span class="token function">getNativeRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">MultipartHttpServletRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>multipartRequest <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 清理</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>multipartResolver<span class="token punctuation">.</span><span class="token function">cleanupMultipart</span><span class="token punctuation">(</span>multipartRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs.advanced.way/framework/spring/springmvc/Session.html" class="prev">
        Session
      </a></span> <span class="next"><a href="/docs.advanced.way/framework/spring/springmvc/RequestMapping.html">
        @RequestMapping
      </a>
      →
    </span></p></div> </main> <aside class="tocSidebar"><div class="tocTitle">当前页</div> <ul class="tocSidebar-sub-headers"><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#dispatcherservlet" class="tocSidebar-link" style="padding-left:0.9rem;font-weight:500;">DispatcherServlet</a><ul class="tocSidebar-sub-headers"><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#结构图" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">结构图</a></li></ul></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#初始化" class="tocSidebar-link" style="padding-left:0.9rem;font-weight:500;">初始化</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#工作流程" class="tocSidebar-link" style="padding-left:0.9rem;font-weight:500;">工作流程</a><ul class="tocSidebar-sub-headers"><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#流程说明" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">流程说明</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#如何进入分发中心" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">如何进入分发中心</a></li></ul></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#请求分发详解" class="tocSidebar-link" style="padding-left:0.9rem;font-weight:500;">请求分发详解</a><ul class="tocSidebar-sub-headers"><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#文件上传请求" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">文件上传请求</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#查找请求处理器" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">查找请求处理器</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#获取处理适配器" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">获取处理适配器</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#处理http缓存" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">处理Http缓存</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#执行前置拦截器链" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">执行前置拦截器链</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#处理适配器执行" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">处理适配器执行</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#返回值视图名处理" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">返回值视图名处理</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#执行后置拦截器链" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">执行后置拦截器链</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#处理返回值和响应" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">处理返回值和响应</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#执行完成拦截器链" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">执行完成拦截器链</a></li><li class="tocSidebar-sub-header"><a href="/docs.advanced.way/framework/spring/springmvc/DispatcherServlet.html#清理资源" class="tocSidebar-link" style="padding-left:0.8rem;font-weight:400;">清理资源</a></li></ul></li></ul></aside></div><div class="global-ui"><!----></div></div>
    <script src="/docs.advanced.way/assets/js/app.49496410.js" defer></script><script src="/docs.advanced.way/assets/js/6.90d4b438.js" defer></script><script src="/docs.advanced.way/assets/js/2.b0fb1ff8.js" defer></script><script src="/docs.advanced.way/assets/js/15.b18efea4.js" defer></script>
  </body>
</html>
